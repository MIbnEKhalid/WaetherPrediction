<!-- Enhanced Hero Header -->
<div class="hero-header-card mb-5">
    <div class="hero-gradient-overlay">
        <div class="container-fluid px-4 py-5">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="hero-content">
                        <div class="location-badge mb-3">
                            <i class="fas fa-map-marker-alt me-2"></i>
                            <span class="location-text">{{metadata.location}}</span>
                        </div>
                        <h1 class="hero-title mb-3">
                            Weather Dashboard
                        </h1>
                        <p class="hero-subtitle mb-4">
                            Comprehensive weather analytics and insights for informed decision making
                        </p>
                        <div class="hero-stats-row">
                            <div class="mini-stat">
                                <i class="fas fa-calendar-alt"></i>
                                <span>{{metadata.dateRange.start}} to {{metadata.dateRange.end}}</span>
                            </div>
                            <div class="mini-stat">
                                <i class="fas fa-database"></i>
                                <span>{{weatherData.length}} records</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="view-selector-card">
                        <h6 class="selector-title mb-3">
                            <i class="fas fa-chart-line me-2"></i>
                            Data View
                        </h6>
                        <div class="modern-btn-group">
                            <a href="/weather?location={{location}}&start_date={{startDate}}&end_date={{endDate}}&view=daily"
                                class="modern-btn {{#eq currentView 'daily'}}active{{/eq}}">
                                <i class="fas fa-calendar-day"></i>
                                <span>Daily</span>
                            </a>
                            <a href="/weather?location={{location}}&start_date={{startDate}}&end_date={{endDate}}&view=weekly"
                                class="modern-btn {{#eq currentView 'weekly'}}active{{/eq}}">
                                <i class="fas fa-calendar-week"></i>
                                <span>Weekly</span>
                            </a>
                            <a href="/weather?location={{location}}&start_date={{startDate}}&end_date={{endDate}}&view=monthly"
                                class="modern-btn {{#eq currentView 'monthly'}}active{{/eq}}">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Monthly</span>
                            </a>
                            <a href="/weather?location={{location}}&start_date={{startDate}}&end_date={{endDate}}&view=yearly"
                                class="modern-btn {{#eq currentView 'yearly'}}active{{/eq}}">
                                <i class="fas fa-calendar"></i>
                                <span>Yearly</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Metadata Card -->
<div class="metadata-card mb-5">
    <div class="card-body p-4">
        <div class="row g-4">
            <div class="col-md-6 col-lg-3">
                <div class="metadata-item">
                    <div class="metadata-icon bg-primary">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <div class="metadata-content">
                        <div class="metadata-label">Coordinates</div>
                        <div class="metadata-value">{{metadata.coordinates.latitude}}°N, {{metadata.coordinates.longitude}}°E</div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="metadata-item">
                    <div class="metadata-icon bg-success">
                        <i class="fas fa-mountain"></i>
                    </div>
                    <div class="metadata-content">
                        <div class="metadata-label">Elevation</div>
                        <div class="metadata-value">{{metadata.elevation}}m</div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="metadata-item">
                    <div class="metadata-icon bg-info">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="metadata-content">
                        <div class="metadata-label">Timezone</div>
                        <div class="metadata-value">{{metadata.timezone}}</div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="metadata-item">
                    <div class="metadata-icon bg-warning">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class="metadata-content">
                        <div class="metadata-label">Export Data</div>
                        <a href="/weather/download?start_date={{startDate}}&end_date={{endDate}}&view={{currentView}}"
                            class="btn btn-sm btn-outline-light mt-1">
                            <i class="fas fa-file-csv me-1"></i> CSV
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><!-- Enhanced Summary Statistics -->
<div class="stats-section mb-5">
    <div class="section-header mb-4">
        <h3 class="section-title">
            <i class="fas fa-chart-bar me-2"></i>
            Weather Overview
        </h3>
        <p class="section-subtitle">Key metrics and statistics for the selected period</p>
    </div>
    
    <div class="row g-4">
        <div class="col-md-6 col-xl-3">
            <div class="enhanced-stat-card temperature-max">
                <div class="stat-card-inner">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-temperature-high"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-up"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value">
                            {{#with (lookup weatherData 0)}}
                            {{formatNumber (max (pluck ../weatherData 'temperature_max')) 1}}°C
                            {{/with}}
                        </div>
                        <div class="stat-label">Maximum Temperature</div>
                        <div class="stat-description">Highest recorded temperature</div>
                    </div>
                    <div class="stat-background">
                        <i class="fas fa-temperature-high"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 col-xl-3">
            <div class="enhanced-stat-card temperature-min">
                <div class="stat-card-inner">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-temperature-low"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value">
                            {{#with (lookup weatherData 0)}}
                            {{formatNumber (min (pluck ../weatherData 'temperature_min')) 1}}°C
                            {{/with}}
                        </div>
                        <div class="stat-label">Minimum Temperature</div>
                        <div class="stat-description">Lowest recorded temperature</div>
                    </div>
                    <div class="stat-background">
                        <i class="fas fa-temperature-low"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 col-xl-3">
            <div class="enhanced-stat-card precipitation">
                <div class="stat-card-inner">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value">
                            {{#with (lookup weatherData 0)}}
                            {{formatNumber (sum (pluck ../weatherData 'precipitation')) 1}}mm
                            {{/with}}
                        </div>
                        <div class="stat-label">Total Precipitation</div>
                        <div class="stat-description">Cumulative rainfall</div>
                    </div>
                    <div class="stat-background">
                        <i class="fas fa-cloud-rain"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 col-xl-3">
            <div class="enhanced-stat-card wind-speed">
                <div class="stat-card-inner">
                    <div class="stat-header">
                        <div class="stat-icon">
                            <i class="fas fa-wind"></i>
                        </div>
                        <div class="stat-trend">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value">
                            {{#with (lookup weatherData 0)}}
                            {{formatNumber (max (pluck ../weatherData 'wind_speed')) 1}} km/h
                            {{/with}}
                        </div>
                        <div class="stat-label">Maximum Wind Speed</div>
                        <div class="stat-description">Peak wind velocity</div>
                    </div>
                    <div class="stat-background">
                        <i class="fas fa-wind"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Charts Section -->
<div class="charts-section mb-5">
    <div class="section-header mb-4">
        <h3 class="section-title">
            <i class="fas fa-chart-line me-2"></i>
            Data Visualization
        </h3>
        <p class="section-subtitle">Interactive charts showing weather patterns and trends</p>
    </div>
    
    <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="chart-card temperature-chart">                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-thermometer-half me-2"></i>
                        <span>Temperature Trends</span>
                    </div>
                    <div class="chart-actions">
                        <button class="btn btn-sm btn-outline-light chart-expand-btn" data-chart="temperatureChart" data-title="Temperature Trends">
                            <i class="fas fa-expand-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-body">
                    <div class="enhanced-chart-container">
                        <canvas id="temperatureChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-card precipitation-chart">                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-cloud-rain me-2"></i>
                        <span>Precipitation</span>
                    </div>
                    <div class="chart-actions">
                        <button class="btn btn-sm btn-outline-light chart-expand-btn" data-chart="precipitationChart" data-title="Precipitation">
                            <i class="fas fa-expand-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-body">
                    <div class="enhanced-chart-container">
                        <canvas id="precipitationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-6">
            <div class="chart-card humidity-chart">                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-tint me-2"></i>
                        <span>Humidity Levels</span>
                    </div>
                    <div class="chart-actions">
                        <button class="btn btn-sm btn-outline-light chart-expand-btn" data-chart="humidityChart" data-title="Humidity Levels">
                            <i class="fas fa-expand-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-body">
                    <div class="enhanced-chart-container">
                        <canvas id="humidityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-card wind-chart">                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-wind me-2"></i>
                        <span>Wind Speed</span>
                    </div>
                    <div class="chart-actions">
                        <button class="btn btn-sm btn-outline-light chart-expand-btn" data-chart="windSpeedChart" data-title="Wind Speed">
                            <i class="fas fa-expand-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-body">
                    <div class="enhanced-chart-container">
                        <canvas id="windSpeedChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Data Table -->
<div class="data-table-section">
    <div class="section-header mb-4">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h3 class="section-title">
                    <i class="fas fa-table me-2"></i>
                    Detailed Data Table
                </h3>
                <p class="section-subtitle">Complete {{currentView}} weather records with all measurements</p>
            </div>
            <div class="table-actions">
                <a href="/weather/download?start_date={{startDate}}&end_date={{endDate}}&view={{currentView}}"
                    class="btn btn-success me-2">
                    <i class="fas fa-download me-1"></i> Export CSV
                </a>
                <button class="btn btn-outline-light" onclick="window.print()">
                    <i class="fas fa-print me-1"></i> Print
                </button>
            </div>
        </div>
    </div>
    
    <div class="enhanced-data-table-card">
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover enhanced-table">
                    <thead class="enhanced-table-header">
                        <tr>
                            <th class="sortable">
                                <i class="fas fa-calendar me-1"></i> 
                                Period
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable temperature-col">
                                <i class="fas fa-temperature-high me-1"></i> 
                                Max Temp
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable temperature-col">
                                <i class="fas fa-temperature-low me-1"></i> 
                                Min Temp
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable humidity-col">
                                <i class="fas fa-tint me-1"></i> 
                                Humidity
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable precipitation-col">
                                <i class="fas fa-cloud-rain me-1"></i> 
                                Precipitation
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                            <th class="sortable wind-col">
                                <i class="fas fa-wind me-1"></i> 
                                Wind Speed
                                <i class="fas fa-sort ms-1"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="enhanced-table-body">
                        {{#each weatherData}}
                        <tr class="data-row">
                            <td class="period-cell">
                                <div class="cell-content">
                                    <i class="fas fa-calendar-day me-2 text-muted"></i>
                                    <strong>{{label}}</strong>
                                </div>
                            </td>
                            <td class="temperature-max-cell">
                                <div class="cell-content">
                                    <span class="temp-value hot">{{formatNumber temperature_max 1}}°C</span>
                                </div>
                            </td>
                            <td class="temperature-min-cell">
                                <div class="cell-content">
                                    <span class="temp-value cold">{{formatNumber temperature_min 1}}°C</span>
                                </div>
                            </td>
                            <td class="humidity-cell">
                                <div class="cell-content">
                                    <div class="progress-bar-mini">
                                        <div class="progress-fill" style="width: {{humidity}}%"></div>
                                        <span class="progress-text">{{formatNumber humidity 1}}%</span>
                                    </div>
                                </div>
                            </td>
                            <td class="precipitation-cell">
                                <div class="cell-content">
                                    <span class="precip-value">{{formatNumber precipitation 1}}mm</span>
                                </div>
                            </td>
                            <td class="wind-cell">
                                <div class="cell-content">
                                    <span class="wind-value">{{formatNumber wind_speed 1}} km/h</span>
                                </div>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Table Footer with Summary -->
        <div class="table-footer">
            <div class="row">
                <div class="col-md-6">
                    <div class="table-summary">
                        <small class="text-muted">
                            Showing {{weatherData.length}} records • {{currentView}} view
                        </small>
                    </div>
                </div>
                <div class="col-md-6 text-end">
                    <div class="table-legend">
                        <small class="text-muted">
                            <span class="legend-item">
                                <span class="legend-color temp-hot"></span> High Temp
                            </span>
                            <span class="legend-item">
                                <span class="legend-color temp-cold"></span> Low Temp
                            </span>
                            <span class="legend-item">
                                <span class="legend-color humidity-bar"></span> Humidity
                            </span>
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart Expansion Modal -->
<div class="modal fade" id="chartModal" tabindex="-1" aria-labelledby="chartModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-fullscreen-lg-down">
        <div class="modal-content bg-dark border-secondary">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-white" id="chartModalLabel">
                    <i class="fas fa-chart-line me-2"></i>
                    Chart View
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <div class="expanded-chart-container">
                    <canvas id="expandedChart"></canvas>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i> Close
                </button>
                <button type="button" class="btn btn-primary" id="downloadChartBtn">
                    <i class="fas fa-download me-1"></i> Download PNG
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    window.chartData = {{{ json chartData }}};
    window.currentYear = new Date().getFullYear();
      // Chart expansion functionality
    document.addEventListener('DOMContentLoaded', function() {
        let expandedChartInstance = null;
        const modal = new bootstrap.Modal(document.getElementById('chartModal'));
        
        // Chart configurations for each chart type
        const chartConfigs = {
            temperatureChart: {
                type: window.chartData.viewType === 'daily' ? 'line' : 'bar',
                data: {
                    labels: window.chartData.labels,
                    datasets: [
                        {
                            label: 'Max Temp (°C)',
                            data: window.chartData.temperatureMax,
                            borderColor: 'rgba(231, 76, 60, 1)',
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            pointBackgroundColor: 'rgba(231, 76, 60, 1)'
                        },
                        {
                            label: 'Min Temp (°C)',
                            data: window.chartData.temperatureMin,
                            borderColor: 'rgba(52, 152, 219, 1)',
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            pointBackgroundColor: 'rgba(52, 152, 219, 1)'
                        }
                    ]
                }
            },
            precipitationChart: {
                type: 'bar',
                data: {
                    labels: window.chartData.labels,
                    datasets: [
                        {
                            label: 'Precipitation (mm)',
                            data: window.chartData.precipitation,
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            borderColor: 'rgba(46, 204, 113, 1)',
                            borderWidth: 1
                        }
                    ]
                }
            },
            humidityChart: {
                type: window.chartData.viewType === 'daily' ? 'line' : 'bar',
                data: {
                    labels: window.chartData.labels,
                    datasets: [
                        {
                            label: 'Humidity (%)',
                            data: window.chartData.humidity,
                            borderColor: 'rgba(155, 89, 182, 1)',
                            backgroundColor: 'rgba(155, 89, 182, 0.7)',
                            pointBackgroundColor: 'rgba(155, 89, 182, 1)'
                        }
                    ]
                }
            },
            windSpeedChart: {
                type: window.chartData.viewType === 'daily' ? 'line' : 'bar',
                data: {
                    labels: window.chartData.labels,
                    datasets: [
                        {
                            label: 'Wind Speed (km/h)',
                            data: window.chartData.windSpeed,
                            borderColor: 'rgba(241, 196, 15, 1)',
                            backgroundColor: 'rgba(241, 196, 15, 0.7)',
                            pointBackgroundColor: 'rgba(241, 196, 15, 1)'
                        }
                    ]
                }
            }
        };
        
        // Enhanced chart options for expanded view
        const expandedChartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            scales: {
                x: {
                    grid: {
                        display: true,
                        color: 'rgba(255,255,255,0.1)'
                    },
                    ticks: {
                        autoSkip: true,
                        maxRotation: 45,
                        minRotation: 0,
                        padding: 15,
                        color: '#e0e0e0',
                        font: {
                            size: 12
                        }
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255,255,255,0.15)'
                    },
                    ticks: {
                        padding: 15,
                        color: '#e0e0e0',
                        font: {
                            size: 12
                        }
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 25,
                        color: '#e0e0e0',
                        font: {
                            size: 14
                        }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(30,30,30,0.95)',
                    titleFont: {
                        size: 16,
                        weight: 'bold'
                    },
                    bodyFont: {
                        size: 14
                    },
                    padding: 15,
                    usePointStyle: true,
                    borderColor: 'rgba(255,255,255,0.3)',
                    borderWidth: 1,
                    callbacks: {
                        label: function (context) {
                            return context.dataset.label + ': ' + context.parsed.y.toFixed(1);
                        }
                    }
                }
            },
            elements: {
                line: {
                    tension: 0.4,
                    borderWidth: 3,
                    fill: false
                },
                point: {
                    radius: 4,
                    hoverRadius: 8,
                    borderWidth: 2
                },
                bar: {
                    borderRadius: 6
                }
            }
        };
        
        // Add click handlers to all expand buttons
        document.querySelectorAll('.chart-expand-btn').forEach(button => {
            button.addEventListener('click', function() {
                const chartId = this.getAttribute('data-chart');
                const chartTitle = this.getAttribute('data-title');
                expandChart(chartId, chartTitle);
            });
        });
        
        function expandChart(chartId, title) {
            // Update modal title
            document.getElementById('chartModalLabel').innerHTML = 
                `<i class="fas fa-chart-line me-2"></i>${title}`;
            
            // Destroy existing expanded chart if any
            if (expandedChartInstance) {
                expandedChartInstance.destroy();
            }
            
            // Get the chart configuration for this chart type
            const config = chartConfigs[chartId];
            if (!config) {
                console.error('Chart configuration not found for:', chartId);
                return;
            }
            
            // Create complete chart configuration
            const expandedConfig = {
                type: config.type,
                data: JSON.parse(JSON.stringify(config.data)), // Deep clone the data
                options: expandedChartOptions
            };
            
            // Show modal first
            modal.show();
            
            // Create expanded chart after modal animation completes
            setTimeout(() => {
                const expandedCanvas = document.getElementById('expandedChart');
                if (expandedCanvas) {
                    expandedChartInstance = new Chart(expandedCanvas, expandedConfig);
                }
            }, 350);
        }
        
        // Download chart functionality
        document.getElementById('downloadChartBtn').addEventListener('click', function() {
            if (expandedChartInstance) {
                const link = document.createElement('a');
                link.download = 'weather-chart.png';
                link.href = expandedChartInstance.toBase64Image('image/png', 1.0);
                link.click();
            }
        });
        
        // Clean up when modal is hidden
        document.getElementById('chartModal').addEventListener('hidden.bs.modal', function() {
            if (expandedChartInstance) {
                expandedChartInstance.destroy();
                expandedChartInstance = null;
            }
        });
    });
</script>